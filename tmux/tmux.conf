# tmux Configuration for Modern Development Workflow
# Optimized for Ghostty integration and conflict-free operation

# Change prefix to Ctrl-Space (avoiding conflicts with Vim and Ghostty)
set -g prefix C-Space
unbind C-b
bind C-Space send-prefix

# Enable mouse support
set -g mouse on

# Improve colors and terminal compatibility
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Enable focus events for vim/neovim
set -g focus-events on

# Reduce command delay
set -sg escape-time 0

# Status line refresh interval
set -g status-interval 5

# Key Bindings
# ==============

# Reload configuration
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Better window splitting
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim-style pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Session management
bind S command-prompt -p "New Session:" "new-session -A -s '%%'"
bind K confirm kill-session

# Copy mode improvements (vi-style)
setw -g mode-keys vi
bind [ copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind ] paste-buffer

# Quick pane selection
bind -r Tab last-window
bind -r ` last-pane

# Pane synchronization
bind e setw synchronize-panes on
bind E setw synchronize-panes off

# Clear screen and history
bind C-l send-keys 'C-l'
bind C-k send-keys -R \; clear-history

# AeroSpace integration for seamless window management
bind-key -r M-h run-shell "aerospace focus left"
bind-key -r M-j run-shell "aerospace focus down"
bind-key -r M-k run-shell "aerospace focus up"
bind-key -r M-l run-shell "aerospace focus right"

# Session management with fzf integration
bind f run-shell "tmux neww ~/.local/bin/tmux-sessionizer"

# Status Bar Configuration
# =========================

# Status bar position
set -g status-position bottom

# Status bar styling
set -g status-style 'bg=#1e1e2e,fg=#cdd6f4'
set -g status-left-length 100
set -g status-right-length 100

# Left status: session name and current path
set -g status-left '#[bg=#89b4fa,fg=#1e1e2e,bold] #S #[bg=#1e1e2e,fg=#89b4fa] #(basename "#{pane_current_path}") '

# Right status: git branch, date, time
set -g status-right '#[fg=#f38ba8]#(cd #{pane_current_path}; git rev-parse --abbrev-ref HEAD 2>/dev/null | sed "s/.*/  &/") #[fg=#cdd6f4]%Y-%m-%d #[fg=#89b4fa]%H:%M '

# Window status styling
setw -g window-status-current-style 'bg=#89b4fa,fg=#1e1e2e,bold'
setw -g window-status-current-format ' #I: #W#F '
setw -g window-status-style 'bg=#313244,fg=#cdd6f4'
setw -g window-status-format ' #I: #W#F '

# Pane border styling
set -g pane-border-style 'fg=#6c7086'
set -g pane-active-border-style 'fg=#89b4fa'

# Message styling
set -g message-style 'bg=#89b4fa,fg=#1e1e2e,bold'

# Plugins Configuration
# =====================

# Plugin manager setup
set -g @plugin 'tmux-plugins/tpm'

# Essential plugins
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'christoomey/vim-tmux-navigator'

# Plugin settings
set -g @resurrect-strategy-nvim 'session'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'